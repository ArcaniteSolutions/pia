<div class="container pia-mainContainerBlock">
  <div class="row">
    <div class="pia-breadcrumb">
      <strong>{{ 'header.homepage_link' | translate }} >
        <ng-container *ngIf="type_entries === 'pia'">
          {{ 'header.current_pias' | translate }}
        </ng-container>
        <ng-container *ngIf="type_entries === 'archive'">
          {{ 'header.archives' | translate }}
        </ng-container>
      </strong>
    </div>

    <div class="small-12 medium-12 columns">
      <div class="pia-filtersBlock">

        <div class="pia-filtersBlock-left">
          <button class="pia-filtersBlock-switch btn" type="button" *ngIf="viewStyle.view === 'list'" (click)="viewOnCard()">
            <i class="fa fa-list" aria-hidden="true"></i>
            <div>{{ 'homepage.filters.card' | translate }}</div>
          </button>
          <button class="pia-filtersBlock-switch btn" type="button" *ngIf="viewStyle.view === 'card'" (click)="viewOnList()">
            <i class="fa fa-list" aria-hidden="true"></i>
            <div>{{ 'homepage.filters.list' | translate }}</div>
          </button>
          <ng-container  *ngIf="type_entries === 'pia'">
            <div *ngIf="viewStyle.view === 'list'" class="pia-filtersBlock-buttons">
              <button type="button" class="btn btn-green" (click)="modalsService.openModal('modal-list-new-pia')"><i class="fa fa-folder-open" aria-hidden="true"></i>{{ 'homepage.filters.new_pia' | translate }}</button>
              <button type="button" (click)="importPia()" class="btn btn-green"><i class="fa fa-upload" aria-hidden="true"></i>{{ 'homepage.filters.import_pia' | translate }}</button>
            </div>
            <div class="pia-filtersBlock-hint"
              *ngIf="viewStyle.view === 'list'
              && entries && entries.length === 0">
              <div>
                <span class="pia-icons pia-icon-rocket-small"></span>
                <p [innerHTML]="'homepage.filters.list_rocket_content' | translate"></p>
              </div>
            </div>
            <div class="hide">
              <form enctype="multipart/form-data" [formGroup]="importPiaForm">
                <input type="file" formControlName="import_file" id="import_file"
                (change)="importPia($event)" class="hide">
              </form>
              <a href="" id="pia-exportBlock"></a>
            </div>
          </ng-container>
        </div>

        <div class="pia-filtersBlock-right">
          <div class="pia-filtersBlock-filters" *ngIf="viewStyle.view === 'card'">
            <button class="pia-filtersBlock-filters-btn btn" type="button">
              <i class="fa fa-filter"></i>
              {{ 'homepage.filters.sort' | translate }}
              <span class="pia-icons pia-icon-scroll-green"></span>
            </button>
            <div class="pia-filtersBlock-filters-list">
              <span>{{ 'homepage.filters.sort_by' | translate }}</span>
              <ul>
                <li [ngClass]="{'active': sortValue === 'name'}">
                  <a (click)="sortBy('name');">{{ 'homepage.filters.name' | translate }}</a>
                </li>
                <li [ngClass]="{'active': sortValue === 'category'}">
                  <a (click)="sortBy('category');">{{ 'homepage.filters.category' | translate }}</a>
                </li>
                <li [ngClass]="{'active': sortValue === 'created_at'}">
                  <a (click)="sortBy('created_at');">{{ 'homepage.filters.date' | translate }}</a>
                </li>
                <li [ngClass]="{'active': sortValue === 'status'}">
                  <a (click)="sortBy('status');">{{ 'homepage.filters.status' | translate }}</a>
                </li>
                <li [ngClass]="{'active': sortValue === 'author_name'}">
                  <a (click)="sortBy('author_name');">{{ 'homepage.filters.author' | translate }}</a>
                </li>
                <li [ngClass]="{'active': sortValue === 'evaluator_name'}">
                  <a (click)="sortBy('evaluator_name');">{{ 'homepage.filters.assessor' | translate }}</a>
                </li>
                <li [ngClass]="{'active': sortValue === 'validator_name'}">
                  <a (click)="sortBy('validator_name');">{{ 'homepage.filters.validator' | translate }}</a>
                </li>
              </ul>
            </div>
          </div>

          <div class="pia-searchInput">
            <input type="text" class="btn btn-search" [ngClass]="{'typed': searchText && searchText.length > 0}"
              [(ngModel)]="searchText" placeholder="{{ 'homepage.search_filter' | translate }}" name="search" autocomplete="off">
              <i class="search-icon">âš²</i>
              <i class="search-close" (click)="onCleanSearch()" *ngIf="searchText && searchText.length > 0">Ã—</i>
          </div>
        </div>

      </div>
    </div>
  </div>
  <div class="row">
    <!-- "Card" mode -->
    <div *ngIf="viewStyle.view === 'card'; else viewList"
      class="small-12 medium-12 columns">

      <!-- New PIA -->
      <div class="pia-cardsBlock pia-newBlock" id="cardsSwitch" *ngIf="type_entries === 'pia'">
        <div class="pia-newBlock-item front" id="pia-new-card">
          <div class="pia-newBlock-item-new">
            <div class="pia-newBlock-item-new-title">{{ 'homepage.cards.new_pia' | translate }}</div>
            <div class="pia-newBlock-item-new-btn">
              <i class="fa fa-folder-open" aria-hidden="true"></i>
              <button
                class="btn"
                (click)="newPIA()"
                type="button"
                title="{{ 'homepage.cards.placeholder_new_pia' | translate }}">
                <span class="pia-icons pia-icon-pia-plus"></span>
              </button>
            </div>
          </div>
          <span>{{ 'homepage.cards.or' | translate }}</span>
          <div class="pia-newBlock-item-import">
            <div class="pia-newBlock-item-import-title">{{ 'homepage.cards.import_pia' | translate }}</div>
            <div class="pia-newBlock-item-import-btn">
              <i class="fa fa-upload" aria-hidden="true"></i>
              <button class="btn" (click)="importPia()" type="button" title="{{ 'homepage.cards.placeholder_import_pia' | translate }}">
                  <span class="pia-icons pia-icon-pia-plus"></span>
              </button>
            </div>
          </div>
        </div>
        <div class="pia-cardsBlock pia-editBlock back">
          <div class="pia-cardsBlock-item pia-editBlock-item">
            <button class="btn" (click)="reversePIA()" type="button"
              title="{{ 'homepage.cards.title_close_creation' | translate }}">
              <span class="pia-icons pia-icon-close"></span>
            </button>
            <app-new-pia (submit)="onPiaSubmited($event)"></app-new-pia>
          </div>
        </div>
      </div>

      <!-- PIA, ARCHIVE Cards switch -->
      <ng-container [ngSwitch]="type_entries">
        <ng-container *ngSwitchCase="'pia'">
          <app-pia-card
            *ngFor="let pia of entries | filterForUser : searchText; let i=index"
            (piaEvent)="piaChange($event)"
            [pia]="pia"
            [previousPia]="i > 0 ? entries[i-1] : null">
          </app-pia-card>
        </ng-container>
        <ng-container *ngSwitchCase="'archive'">
          <app-archive-card
            *ngFor="let archivedPia of entries | filterForUser : searchText; let i=index"
            [archivedPia]="archivedPia"
            [previousArchivedPia]="i > 0 ? entries[i-1] : null">
          </app-archive-card>
        </ng-container>
        <ng-container *ngSwitchCase="'structure'">
          <app-structure-card
            *ngFor="let structure of entries | filterForUser : searchText; let i=index"
              (structEvent)="structChange($event)"
              [structure]="structure"
              [previousStructure]="i > 0 ? entries[i-1] : null">
          </app-structure-card>
        </ng-container>
        <ng-container *ngSwitchDefault>

        </ng-container>
      </ng-container>

    </div>

    <!-- "List" mode -->
    <ng-template #viewList>
      <div class="small-12 medium-12 columns">
        <table class="pia-list-table">
          <thead>
            <tr>
              <th>
                <span></span>
              </th>
              <th>
                <a (click)="sortBy('name')">
                  <span>{{ 'homepage.lists.column_pia' | translate }}</span>
                  <i class="fa"
                    [ngClass]="[sortValue === 'name' ? 'fa-caret-' + sortOrder : 'fa-caret-down desactivate']"></i>
                </a>
              </th>
              <th>
                <a (click)="sortBy('updated_at')">
                  <span>{{ 'homepage.lists.column_updated_at' | translate }}</span>
                  <i class="fa"
                    [ngClass]="[sortValue === 'updated_at' ? 'fa-caret-' + sortOrder : 'fa-caret-down desactivate']"
                  ></i>
                </a>
              </th>
              <th>
                <a (click)="sortBy('author_name')">
                  <span>{{ 'homepage.lists.column_author' | translate }}</span>
                  <i class="fa"
                    [ngClass]="[sortValue === 'author_name' ? 'fa-caret-' + sortOrder : 'fa-caret-down desactivate']"
                  ></i>
                </a>
              </th>
              <th>
                <a (click)="sortBy('evaluator_name')">
                  <span>{{ 'homepage.lists.column_evaluation' | translate }}</span>
                  <i class="fa"
                    [ngClass]="[sortValue === 'evaluator_name' ? 'fa-caret-' + sortOrder : 'fa-caret-down desactivate']"
                  ></i>
                </a>
              </th>
              <th>
                <a (click)="sortBy('validator_name')">
                  <span>{{ 'homepage.lists.column_validation' | translate }}</span>
                  <i class="fa"
                    [ngClass]="[sortValue === 'validator_name' ? 'fa-caret-' + sortOrder : 'fa-caret-down desactivate']"
                  ></i>
                </a>
              </th>
              <th>
                <a (click)="sortBy('structure_name')">
                  <span>{{ 'homepage.lists.column_structure_name' | translate }}</span>
                  <i class="fa"
                    [ngClass]="[sortValue === 'structure_name' ? 'fa-caret-' + sortOrder : 'fa-caret-down desactivate']"
                  ></i>
                </a>
              </th>
              <!-- <th>
                <a (click)="sortBy('created_at')">
                  <span>{{ 'homepage.lists.column_creation' | translate }}</span>
                  <i *ngIf="sortValue === 'created_at'" class="fa fa-caret-{{sortOrder}}"></i>
                </a>
              </th> -->
              <!-- <th>
                <a (click)="sortBy('status')">
                  <span>{{ 'homepage.lists.column_status' | translate }}</span>
                  <i *ngIf="sortValue === 'status'" class="fa fa-caret-{{sortOrder}}"></i>
                </a>
              </th> -->
              <th>
                <a (click)="sortBy('progress')">
                  <span>{{ 'homepage.lists.column_status' | translate }}</span>
                  <i class="fa"
                    [ngClass]="[sortValue === 'progress' ? 'fa-caret-' + sortOrder : 'fa-caret-down desactivate']"
                  ></i>
                </a>
              </th>
            </tr>
          </thead>
          <tbody>
            <ng-container [ngSwitch]="type_entries">
              <ng-container *ngSwitchCase="'pia'">
                <app-pia-line class="app-list-item"
                  [ngClass]="{'pia-exampleBlock': pia.is_example === 1}"
                  [attr.data-id]="pia.id"
                  *ngFor="let pia of entries | filterForUser : searchText; let i=index"
                  (piaEvent)="piaChange($event)"
                  [pia]="pia">
                </app-pia-line>
              </ng-container>
              <ng-container *ngSwitchCase="'archive'">
                <app-archive-line class="app-list-item"
                  [attr.data-id]="archivedPia.id"
                  *ngFor="let archivedPia of entries | filterForUser : searchText; let i=index"
                  [archivedPia]="archivedPia">
                </app-archive-line>
              </ng-container>
              <ng-container *ngSwitchDefault>

              </ng-container>
            </ng-container>
          </tbody>
        </table>
      </div>
    </ng-template>
  </div>
</div>
<app-modals (continueEvent)="refreshContent()"></app-modals>
